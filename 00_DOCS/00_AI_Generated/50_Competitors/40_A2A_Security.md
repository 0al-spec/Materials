# Безопасность спецификации Google Agent-to-Agent (A2A)

1. Инфраструктурная изоляция и безопасное выполнение агентов

Архитектура и изоляция: Протокол A2A спроектирован так, что каждый AI-агент выступает отдельным сервисом (клиент/сервер), не раскрывающим внутреннее состояние другим агентам. Агенты считаются «непрозрачными» – они не разделяют память, инструменты или прямой доступ к ресурсам между собой . Такой подход соответствует традиционной микросервисной архитектуре и укрепляет безопасность за счёт строгих границ между агентами. Реализация обычно предполагает развёртывание каждого агента в изолированной среде (например, отдельном контейнере или виртуальной машине) с минимальными привилегиями, что ограничивает потенциальный ущерб от сбоев или компрометации одного агента. MAESTRO-модель угроз выделяет инфраструктуру (серверы, сети, контейнеры) как критичный уровень безопасности – платформа хоста должна быть защищена и гибко масштабироваться под нагрузки автономных агентов .

Контейнеризация и “песочницы”: Для безопасного выполнения кода агента применяются механизмы контейнеризации и sandbox-изоляции. Каждый агент может запускаться в своём изолированном контейнере с ограниченными системными правами, используя неизменяемые образы и контроль ресурсов. Такой «безопасный контейнер» действует как песочница, не позволяя агенту выйти за пределы разрешённых операций на хост-системе . Если агенту необходимо исполнение произвольного кода или скриптов, оно происходит внутри ограниченной среды (напр., seccomp/jail в ОС или внутри отдельного процесса), предотвращая воздействие на основную систему. Также рекомендуется сетевая сегментация: агенты размещаются в отдельных сегментах сети или виртуальных подсетях, где трафик фильтруется и контролируется, что затрудняет несанкционированное взаимодействие между ними . Эти меры инфраструктурной изоляции минимизируют «радиус поражения» в случае атаки, обеспечивая, что компрометация одного агента не даст прямого доступа к другим или к базовым ресурсам.

2. Авторизация и контроль доступа между агентами

Agent Card и объявление требований: Безопасное взаимодействие начинается с механизма обнаружения агента и объявления его политик доступа. Каждый A2A-сервер публикует специальный JSON-файл Agent Card (/.well-known/agent.json), где описаны идентификационные данные агента, его возможности (skills), URL конечной точки и требования к аутентификации для клиентов  . По сути, Agent Card служит паспортом агента: клиент-агент сначала запрашивает эту карточку, чтобы узнать, какими методами нужно удостовериться (например, OAuth 2.0, API-ключ и т.п.) и какие навыки (операции) предоставляет удалённый агент. В поле security Agent Card перечисляются поддерживаемые схемы аутентификации (типично совпадающие со стандартами OpenAPI, например "oauth2", "apiKey", "basic" и др.) . Таким образом, модель разрешений A2A объявляется заранее: клиенты знают, какой тип токена или ключа требуется, и какие действия им будут позволены.

Аутентификация (OAuth2/OpenID и др.): Протокол A2A не изобретает собственных методов аутентификации, а полагается на стандартные веб-механизмы. Клиент получает необходимые учётные данные вне рамок A2A – например, проходит OAuth 2.0-авторизацию для получения токена доступа или берёт API-ключ из безопасного хранилища  . Агент-сервер указывает в Agent Card приемлемые схемы (Bearer-токен OAuth2, Basic Auth, ключ API и пр.), после чего клиент запрашивает токен у соответствующего провайдера (Identity Provider) и включает эти креденшалы в HTTP-заголовки каждого A2A-запроса (например, Authorization: Bearer <token> для OAuth)  . A2A-сервер обязан проверить авторизацию каждого запроса согласно указанной схеме и своим политикам, отклоняя запросы без валидных токенов (с возвратом 401 Unauthorized/403 Forbidden)  . Благодаря этому аутентификация проводится на транспортном уровне (HTTPS), а не внутри самих полезных данных JSON-RPC – никаких паролей или идентификаторов пользователя в теле сообщений не передаётся .

Авторизация и модели доступа: После удостоверения личности клиента вступают в силу политики авторизации на стороне сервера. Каждому агенту могут соответствовать собственные правила, но общие рекомендации включают принцип минимально необходимых прав. A2A-сервер должен разрешать или запрещать операции на основе нескольких факторов: аутентифицированная сущность клиента (пользователь или приложение), запрошенный навык/действие агента, контекст задачи и корпоративные политики безопасности  . В Agent Card у каждого умения (skill) может быть указан требуемый уровень допуска – например, наличие определённого OAuth scope в токене клиента, чтобы вызвать данное действие . Таким образом, доступ ограничивается по scope/ролям и по типам задач: даже получив токен, агент-клиент сможет инициировать только те задачи, на которые ему выданы права. Агент-сервер выступает “шлюзом”, проверяющим привилегии перед выполнением потенциально опасных операций (доступ к БД, изменению данных и т.д.) . В результате принцип наименьших привилегий соблюдается на уровне задач: выдаются лишь те разрешения, которые необходимы для конкретного запроса .

Just-in-Time Access и динамические токены: В духе Zero Trust архитектуры A2A поддерживает подход «доступ по требованию». Вместо долгосрочных широких привилегий используются временные токены и креденшалы, действительные только в пределах конкретной задачи или сеанса . Например, если в ходе работы агента ему требуется доступ к внешнему сервису от имени пользователя, A2A рекомендует перевести задачу в состояние “требуется ввод” и запросить у клиента дополнительные учетные данные только для этой цели. Клиент вне протокола получает вторичный токен (например, проходя OAuth для нужного API) и передает его обратно агенту для продолжения задачи  . Такой Just-in-Time подход гарантирует, что полномочия выдаются строго на время выполнения конкретного шага, после чего утрачивают силу. Тем самым снижается риск злоупотребления: даже скомпрометированный агент не сможет несанкционированно использовать привилегии за рамками текущей задачи. Дополнительно, каждый запрос проходит повторную проверку прав – авторизация не считается раз и навсегда установленной на всю сессию, а подтверждается на каждом шаге взаимодействия . Это не позволяет злоумышленнику эскалировать доступ, перехватив токен: контекст и срок действия строго ограничены текущей операцией.

3. Журналирование и трассировка межагентной коммуникации

Распределённая трассировка запросов: Так как A2A использует HTTP(S) в качестве транспортного уровня, он нативно интегрируется со стандартными инструментами мониторинга и трейсинга, уже применяемыми в предприятиях . Рекомендуется задействовать распределённый трекинг запросов: каждый A2A-запрос/ответ снабжается уникальными идентификаторами трассы (например, заголовки Traceparent и Tracestate по спецификации W3C) . Клиентские и серверные агенты передают далее эти trace-ID, что позволяет связать цепочку вызовов сквозь несколько агентов. В результате администраторы получают end-to-end видимость: можно отследить, как пользовательский запрос проходит через ряд автономных агентов, сколько времени занимает каждый этап, где мог произойти сбой или задержка . Такая сквозная трассировка критически важна для отладки сложных мультиагентных сценариев и анализа производительности.

Подробное логирование и аудит: Помимо трассировки, каждый узел должен вести подробные журналы событий, фиксируя ключевую информацию для корреляции и аудита . Логи A2A-клиента и сервера включают идентификаторы задач (taskId), сессий, корреляционные ID сообщений, упомянутые trace-ID, а также отметки времени и данные об участниках коммуникации. Благодаря этому можно точно проследить, какой агент отправил запрос, какой ответ был получен и в какое время . Для корпоративного соответствия и расследования инцидентов обязателен аудит критичных действий: протоколирование таких событий, как создание или отмена задачи, эскалация прав, доступ к конфиденциальным данным или выполнение высокорисковых операций агентом . Эти события аудитора снабжаются информацией об инициаторе (какой агент или пользователь), целевом ресурсе и результате операции. Цепочки доверия (chain-of-trust) между агентами обеспечиваются в том числе через такие логи – каждая коммуникация сопровождается проверкой подлинности агента-отправителя и фиксированием его подтверждённой идентификации. Например, клиент проверяет сертификат TLS сервера перед установлением соединения и доверяет ему только если сертификат подписан доверенным центром (предотвращение MITM)  . В перспективе возможна регистрация самих Agent Card в публичных реестрах или журнал прозрачности сертификатов, чтобы у клиентов была достоверная цепочка доверия к личности агента (например, через подпись карточки цифровым сертификатом провайдера) . Все проверки и верификации (проверка сертификата, подписи Agent Card, применённые OAuth scope и т.д.) также могут отражаться в журналах. Совокупно, сочетание трассировки и логирования позволяет как оперативно отслеживать взаимодействия агентов, так и ретроспективно анализировать инциденты, имея полный аудиторский след обмена сообщениями.

4. Обнаружение и предотвращение атак между агентами

Проактивный анализ угроз (MAESTRO): Появление экосистемы взаимодействующих автономных агентов открывает новые векторы атак, поэтому Google применяет специальный фреймворк threat modeling под названием MAESTRO (Multi-Agent Environment Security Threat Risk and Outcome). MAESTRO охватывает семь уровней безопасности – от уязвимостей самих AI-моделей и данных, до инфраструктуры деплоя и многого агентского взаимодействия . В отличие от классических моделей (STRIDE, DREAD и пр.), MAESTRO учитывает AI-специфические аспекты: нелинейное поведение моделей, автономность агентов, динамические удостоверения и т.д.  . Применяя MAESTRO к A2A, исследователи выявили множество потенциальных угроз и методов их смягчения  . Например, анализ Layer 3 (уровня протокола агента) указал на риск подмены агента – злоумышленник может выдать себя за легитимный сервис, опубликовав поддельную Agent Card или украв учетные данные агента . Другая угроза – инъекция сообщений: отправка специально сформированных вредоносных сообщений, которые обманут принимающий агент или вызовут нежелательные действия . Также рассматриваются атаки на понижение протокола (forcing older insecure version)  и компрометация доверенного сервера (запуск фальшивого A2A-узла от имени известной компании) . Используя структурированный подход MAESTRO, для каждой угрозы оцениваются уязвимости, вероятность/влияние и предлагаются контрмеры.

Криптографические подписи и верификация: Ключевым методом защиты от атак на целостность и подмену является широкое применение криптографии. Протокол A2A изначально разрабатывается по принципу «Secure-by-Default», включая подписи и валидацию критичных объектов. В частности, рекомендуется подписывать Agent Card цифровой подписью издателя (например, приватным ключом организации, владеющей агентом) и проверять эту подпись на стороне клиента по публичному ключу . Подписанная карточка не позволит злоумышленнику тайно подменить объявления навыков или требований аутентификации – клиент обнаружит несоответствие подписи. Помимо этого, предлагается впоследствии подписывать и каждое межагентное сообщение или задание: цифровая подпись сообщения гарантирует его целостность и подлинность источника, устраняя возможность тихой подмены команд по пути следования . В совокупности, криптографические меры обеспечивают, что агент может криптографически верифицировать личность собеседника и непрерывность сессии. В реализациях также рассматривается использование децентрализованных идентификаторов (DID) для агентов и сервисов: DID-методика позволяет регулярно обновлять удостоверяющие документы агента и проверять их через распределённый реестр доверия  . Это усложняет злоумышленнику задачу выдавать себя за другого, так как потребуется скомпрометировать зарегистрированную сущность в нескольких местах.

Предотвращение эскалации привилегий: Спецификация A2A предусматривает, что каждый запрос аутентифицирован и авторизован с учётом своих полномочий. Тем самым затрудняется атака, при которой один агент попытался бы использовать свой доступ для действий вне своей компетенции. Каждое задание сопровождается проверкой полномочий в контексте данного Task ID – если агент А делегирует под-задачу агенту B, тот не сможет выполнять больше, чем разрешено токеном или scope, предоставленным агентом А . В Zero Trust парадигме даже внутри согласованного обмена каждый шаг перепроверяется: если агент пытается вызвать у другого агента навык, на который не выдано разрешение текущему токену, запрос будет отклонён . Такой подход, по сути, блокирует межагентную эскалацию прав – агент не может “вытребовать” для себя больше доступа через A2A, чем явно санкционировано. Более того, рекомендовано проверять учётные данные при каждом новом Task: даже если агент X ранее успешно общался с Y, новая задача требует вновь предъявить действующий токен с необходимыми scope, чтобы гарантировать актуальность прав и отсутствие отзыва доступа .

Другие механизмы защиты: В набор мер «Defence-in-Depth», предложенных для A2A, входят и дополнительные технические контролы. Для противодействия атакам повторного воспроизведения вводятся одноразовые метки и метки времени (nonce + timestamp) в задачи или сообщения – это не даст злоумышленнику повторно использовать захваченный трафик позже . Валидация схем и фильтрация ввода встроена в обработку сообщений: агент-сервер проверяет структуру входящего JSON (соответствие схеме), типы контента частей (Parts) и применяет фильтры для текста, чтобы отсеять заведомо недопустимый или опасный контент . Например, для DataPart может требоваться соответствие объявленному JSON-формату, файлы проверяются на отсутствие исполняемого содержимого, текстовые запросы могут пропускаться через детектор командInjection или нежелательного контента. Верификация сертификатов с пиннингом на уровне TLS предотвращает перехват или подмену агента на сетевом уровне – клиент может “прикрепить” (pin) конкретный корневой или серверный сертификат, ожидаемый у партнёра, и отклонять соединение, если предъявлен иной сертификат . Наконец, методики обнаружения аномалий и репутационные системы для агентов предлагаются как дополняющие меры: мониторинг нетипичного поведения агента или отклонений в его коммуникациях может сигнализировать о компрометации  . Все эти меры в комбинации затрудняют осуществление атак “агент на агента” и позволяют раннее обнаружение попыток нарушения безопасности.

5. A2A и модель Zero Trust-инфраструктуры

Принципы Zero Trust (нулевого доверия) органично дополняют и усиливают безопасность A2A. В традиционных системах безопасность часто опиралась на периметр – предполагалось, что внутренним узлам можно доверять больше, чем внешним. В случае же автономных агентов, постоянно взаимодействующих через границы систем и организаций, такой подход не работает  . Zero Trust исходит из положения «никому не доверять по умолчанию, каждый раз проверять», что отлично соответствует динамике AI-агентов. Каждое межагентное обращение рассматривается как недоверенное, пока не подтверждено обратное . Ниже приведены ключевые элементы Zero Trust, реализуемые в A2A-экосистеме:
	•	Временные токены и Just-in-Time доступ: A2A стремится не давать агентам постоянных “широких” ключей доступа. Вместо этого применяются краткоживущие токены, выпускаемые “на лету” под конкретную задачу или сессию . Такой токен действует ограниченное время и с узким набором прав (scope). После выполнения задачи токен истекает, что резко снижает шансы компрометации – даже перехватив его, злоумышленник успеет нанести минимальный ущерб. Just-in-Time (JIT) выдача прав также означает, что доступ предоставляется только когда он действительно нужен. Например, агент запрашивает у центра авторизации токен непосредственно перед вызовом конкретного API другого агента, а не хранит постоянно действующие креденшалы. Это устраняет лишние привилегии и соответствует политике минимально необходимого доступа.
	•	Непрерывная проверка и минимальные привилегии: Zero Trust требует проверять каждый запрос, а не только первый. В контексте A2A это выражается в том, что каждый обмен сообщениями сопровождается повторной аутентификацией и авторизацией (по необходимости) вместо слепого доверия установленной сессии . Кроме того, все агенты и токены настроены по принципу least privilege – агенту выдаются только те права, которые нужны для его текущей задачи . Например, если агент HR взаимодействует с агентом финансов, то токен HR-агента может позволять лишь чтение необходимых данных, но не запись или удаление. При каждом новом действии права сверяются с политиками. Такая постоянная валидация гарантирует, что даже внутри периметра нет “привилегированных” узлов: любое действие должно быть обосновано и разрешено.
	•	Криптографическая уверенность и доверенные цепочки: Zero Trust опирается на сильную криптографию для установления доверия. В A2A это реализовано через TLS шифрование с проверкой сертификатов, а также планы по внедрению цифровых подписей на артефакты обмена (Agent Card, сообщения) . Каждое соединение между агентами проходит проверку сертификата на соответствие доверенному удостоверяющему центру, возможна дополнительная защита через взаимную аутентификацию TLS (mTLS), когда и клиент-агент предъявляет свой сертификат серверу  . Подписи Agent Card и сообщений позволяют криптографически подтвердить авторство и целостность, формируя цепочку доверия: агент А доверяет агенту B, потому что B предъявил подписанный набор атрибутов, проверенный по известному корневому ключу. Отказ от любого незащищённого шага (например, запрет HTTP без TLS, запрет неподписанных критических данных) — фундаментальное требование Zero Trust, полностью воплощённое в A2A  .
	•	Доверенные среды исполнения (TEE): Ещё один элемент, сопряжённый с Zero Trust, — обеспечение доверия к окружению, в котором выполняется код агента. Дополнительной мерой может служить использование аппаратных доверенных сред (Trusted Execution Environments). Например, разработчики могут развёртывать A2A-агентов в облачной инфраструктуре, поддерживающей TEE (Intel SGX, AMD SEV или аналогичных). В таких средах код и данные агента изолированы на аппаратном уровне: даже с компрометацией ОС злоумышленник не сможет прочитать или изменить исполняемый агентом код и конфиденциальные данные. Платформы вроде Phala Network предлагают хостинг A2A/MCP-серверов во внутри TEE, что блокирует атаки типа инъекций команд или чтения памяти из-вне контейнера  . Вдобавок TEE обеспечивает удалённую аттестацию – криптографическое доказательство того, что агент запущен в неизменённой среде, на одобренной версии кода . Таким образом, другие агенты или пользователи могут проверять “честность” собеседника до начала обмена. Хотя спецификация A2A напрямую не требует TEE, интеграция доверенных окружений исполнения рассматривается как перспективное направление для самых критичных сценариев (например, финансовые или медицинские мультиагентные системы), дополняя Zero Trust-инфраструктуру ещё одним уровнем защиты.

В целом, комбинация протокола A2A с принципами Zero Trust позволяет создать «недоверенную» архитектуру, где каждый агент, каждый запрос и каждая учётная запись непрерывно проверяются, доступы минимизируются, а выполнение происходит в максимально контролируемой среде. Это значительно повышает устойчивость мультиагентных систем к компрометации и злоумышленным воздействиям, готовя почву для безопасного развёртывания автономных ИИ-агентов в корпоративных условиях.

Источники: Все вышеперечисленные меры и рекомендации взяты из открытых материалов Google по A2A и анализа безопасности данного протокола    , включая черновой спецификационный документ A2A, блог Google Cloud, а также обзорные статьи Cloud Security Alliance и независимых экспертов по кибербезопасности AI. Эти материалы единодушно подчёркивают, что надёжная безопасность A2A достигается сочетанием правильной инфраструктуры, строгой аутентификации/авторизации, полного аудита, криптографических гарантий и Zero Trust-подхода, адаптированного к особенностям агентных систем.