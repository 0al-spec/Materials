# Amazon Bedrock AgentCore: Архитектура и безопасность

## Архитектура Amazon Bedrock AgentCore

Amazon Bedrock AgentCore – это комплекс управляемых сервисов AWS (пока в режиме превью), предназначенных для безопасного развёртывания и масштабирования AI-агентов в продакшене. Архитектура AgentCore модульная: она включает ряд компонентов, каждый из которых решает отдельную задачу, и которые можно использовать независимо либо совместно  . К основным компонентам относятся:
	•	AgentCore Runtime – серверлес-окружение для запуска кода агентов. Runtime обеспечивает быстрый старт и полную изоляцию сессий: каждая пользовательская сессия агента исполняется в своей защищённой среде, что предотвращает утечки данных между сессиями . Эта среда «песочницы» (sandbox) поддерживает любые фреймворки агентов (например, LangChain, Strands, CrewAI) и модели, а также рассчитана на мультимодальные и длительно работающие агенты . Разработчик деплоит код агента с помощью SDK AgentCore, указывая точку входа – дальнейшее управление инфраструктурой (выделение контейнеров/виртуальных сред) AWS берёт на себя  . Для сетевой изоляции Runtime поддерживает различные режимы: Sandbox (доступ только к разрешённым сервисам AWS), Public (управляемый выход в интернет), а в будущем – VPC-only для доступа к ресурсам в приватной сети клиента .
	•	AgentCore Memory – модуль памяти, упрощающий добавление долговременного контекста агентам. Он хранит краткосрочную память (контекст мультитурового диалога) и долгосрочную память (знания, разделяемые между сессиями или разными агентами) без необходимости вручную строить инфраструктуру векторных баз данных  . Разработчик может управлять, какую информацию агент запоминает, с помощью готовых «рецептов» или собственных спецификаций памяти. Хранилище поддерживает изоляцию по именованным пространствам, чтобы разделять или наоборот разделять память между разными контекстами приложений .
	•	AgentCore Gateway – шлюз для интеграции инструментов и внешних сервисов. Gateway позволяет регистрировать существующие API, функции AWS Lambda, базы данных (S3, DynamoDB, Redshift и др.) или сторонние сервисы в качестве «инструментов» для агентов . Он трансформирует их в унифицированный формат, совместимый с агентными протоколами (поддерживается стандарт Model Context Protocol (MCP), скоро добавится Agent-to-Agent (A2A) ). Это избавляет от необходимости писать обвязку для каждого сервиса – агент может обнаруживать и вызывать инструменты через единый интерфейс Gateway. Для разработчика это экономит недели работы по интеграции и настройке безопасности . Gateway тесно связан с другими компонентами AgentCore: например, вызовы инструментов проходят через Runtime (для безопасного исполнения), используют Identity (для аутентификации) и логируются в Observability .
	•	Встроенные инструменты (Tools) – AgentCore предоставляет из коробки два мощных инструмента: Browser и Code Interpreter. Browser tool – это облачный браузер, к которому агент может обращиться для просмотра веб-сайтов, скрапинга информации и т.д., не выходя за пределы AWS. Каждый браузерный сеанс запускается в изолированной среде (уровня VM, виртуальной машины) и отделён от других сессий . Этот инструмент автоматически масштабируется под нагрузку и включает средства наблюдения – например, можно в режиме реального времени видеть, что «видел» агент в веб-странице, записывать историю сессии и все действия сохраняются в CloudTrail для аудита  . Code Interpreter tool предназначен для безопасного выполнения кода, сгенерированного агентом. Агент может передать кусок кода (например, Python или JavaScript) в этот инструмент, и Code Interpreter выполнит его в песочнице, изолированной от основной среды агента  . Это позволяет реализовать сложные функции – от вычислений и анализа данных до вызова произвольных библиотек – без риска для основной системы. Code Interpreter предоставляет готовые окружения с предустановленными библиотеками, поддерживает работу с крупными файлами (напрямую из S3) и при необходимости доступ в интернет, причём администратор может настроить уровень доступа под требования безопасности  . Оба инструмента спроектированы так, чтобы соответствовать корпоративным стандартам безопасности и комплаенса, и избавляют разработчика от самостоятельного поднятия подобных инфраструктур.
	•	AgentCore Identity – подсистема управления идентификацией и доступом для агентов. Identity выдаёт каждому AI-агенту отдельную цифровую личность и контролирует, что агент имеет право делать. Она интегрируется с корпоративными Identity Provider (например, Amazon Cognito, Okta, Microsoft Entra ID и др.), так что можно не заводить новых учетных записей специально под агентов  . В архитектуре AgentCore агент может действовать от имени пользователя (после явного согласия пользователя) или от собственного имени (с ограниченными предразрешёнными правами). В обоих случаях Identity выдаёт и хранит необходимые токены доступа. Встроенный хранилище токенов (token vault) безопасно сохраняет OAuth-токены пользователей и API-ключи, чтобы агент мог многократно обращаться к сторонним сервисам без повторного запроса пароля у пользователя  . Identity реализует принцип минимально необходимого доступа: например, токены и AWS-роли для агента можно скоупировать так, чтобы он имел доступ только к тем ресурсам или API, которые нужны для его функций  . Делегирование прав строго контролируется – агент не получает ничего «просто так», а должен явно предъявить свои учётные данные при каждом обращении к защищённому ресурсу.
	•	AgentCore Observability – система мониторинга и отладки, обеспечивающая прозрачность работы агентов. Observability собирает телеметрию всех запусков и шагов агента: входные запросы, вызовы инструментов, ответы модели, сгенерированные сообщения и пр.  . В AWS Console доступны визуальные дашборды (на базе Amazon CloudWatch) с ключевыми метриками – количество сессий, время ответа, длина диалогов (токенов), ошибки и т.д.  . Для глубокой отладки можно просмотреть пошаговое дерево reasoning’а агента – какие инструменты он вызывал, какие промежуточные результаты получил, какой ответ построил и т.п. Это упрощает аудит качества и поиск причин некорректного поведения. Кроме того, все логи и трассировки совместимы со стандартом OpenTelemetry, поэтому их можно интегрировать в сторонние системы мониторинга или в существующие AI Observatory-платформы (например, LangSmith, Arize и т.д.)  .

Исполнение агентов в AgentCore выглядит следующим образом. Разработчик регистрирует приложение-агента, указывая его код и конфигурацию (например, какие инструменты и память использовать, какие учётки подключены). При запуске пользователем (либо триггере через API) AgentCore Runtime поднимает изолированное выполнение (по сути, аналог облачной функции), выделяет для него нужные ресурсы. Код агента (например, реализованный с помощью фреймворка LangChain или Strands) загружается и начинает диалоговую сессию. При работе агент может запрашивать сохранённые контексты из Memory, обращаться к внешним API или базам через Gateway, выполнять код или открывать сайты через встроенные инструменты. Все эти операции проходят в пределах контролируемой AWS-среды с применением необходимых ограничений и логированием. После завершения сессии среда уничтожается, освобождая ресурсы. Благодаря серверлес-архитектуре, AgentCore автоматически масштабируется под нагрузку – можно параллельно запустить тысячи сессий агентов, не беспокоясь о ручном менеджменте серверов  . Разработчик платит только за фактическое время работы агентов и использования инструментов, что делает платформу экономически гибкой (в период превью до сентября 2025 сервис был бесплатным) .

Механизмы безопасности и контроль доступа

Безопасность является ключевым элементом дизайна AgentCore – сервис прямо нацелен на enterprise-сценарии, требующие строгого контроля доступа и отслеживаемости действий агентов  . Рассмотрим, как в AgentCore реализованы идентификация агентов, контроль прав, а также аудит их действий:

Идентификация агента. В традиционных системах IAM (identity and access management) субъекты – это либо люди, либо сервисные учётные записи. В AgentCore же AI-агент выступает как полноправный субъект с собственной личностью (identity). Сервис AgentCore Identity присваивает каждому агенту уникальный идентификатор и ведёт его учетку для аутентификации. При интеграции с корпоративными каталогами пользователей (SSO, IdP) агент может отображаться как отдельное приложение/клиент. Например, Microsoft планирует выдавать каждому корпоративному AI-агенту отдельный Entra ID, по аналогии с сотрудником компании . AWS реализует схожий подход: AgentCore Identity позволяет связать агента с Amazon Cognito или Azure AD, выдать ему OAuth2-клиент и хранить его секреты  . Таким образом, каждый раз, когда агент пытается получить доступ к ресурсу, он предъявляет свои учётные данные – будь то токен, API-ключ или временные AWS-учетные данные – и проходит стандартную проверку так же, как это сделал бы человек-пользователь или сервис. Нет «доверия по умолчанию»: любая операция агента требует проверки его прав (principle Never trust, always verify).

Аутентификация и делегирование прав. Для доступа к внешним сервисам (GitHub, Google, Salesforce и т.п.) агент должен получить OAuth-токен пользователя или собственный API-ключ. Процесс выглядит так: при первом обращении к интеграции AgentCore перенаправляет пользователя на страницу OAuth2.0 Consent, где тот явно разрешает агенту действовать от своего имени . После этого Identity сохраняет выданный токен в зашифрованном хранилище. При последующих вызовах агент может по требованию извлечь этот токен из хранилища – автоматически, без вмешательства пользователя – и прикрепить к своим запросам  . Например, если агенту нужно отправить сообщение в Slack или вытащить данные из Google Calendar, он получает для этого соответствующий bearer-токен из vault. Когда срок действия токена истекает, система снова запросит обновлённое разрешение у пользователя, предотвращая несанкционированный доступ . Для сервисов на API-ключах схема аналогична: ключ хранится в Identity, и агент получает его только когда действительно вызывает этот инструмент .

Для доступа к ресурсам AWS (например, чтение из S3, запись в DynamoDB) агент также действует через делегирование. При деплое агенту назначается так называемая execution role – это роль IAM, от имени которой будет работать AgentCore Runtime, запускающий данного агента . Разработчик сам задаёт политику этой роли, строго ограничивая перечень допустимых действий (например, только чтение определённого S3 bucket и никаких админ-операций). Когда Runtime инициирует новую сессию агента, он ассимилирует (assume) эту IAM-роль – тем самым все обращения к AWS API из кода агента проходят с правами, ограниченными рамками этой роли . Если агент попытается выйти за разрешённые пределы (скажем, удалить объект в S3 при роли, дающей только чтение) – AWS API вызов будет отклонён по стандартным правилам IAM. Этот уровень контроля встроен глубоко: даже если сам LLM внутри агента решит «пошалить», технически он не сможет нарушить заданные IAM-политики. Такой подход соответствует принципу least privilege – у агента ровно столько прав, сколько ему необходимо для задачи, и не более .

Изоляция и sandboxing. AgentCore применяет многослойную изоляцию, чтобы ошибки или злонамеренные действия агента не повлияли на систему в целом. Изоляция сессий означает, что одновременные запуски агента (для разных пользователей или запросов) не имеют общей памяти или файловой системы – каждая работает в отдельном окружении, данные между ними не перетекают без явного разрешения . Это предотвращает утечки конфиденциальной информации между разными пользователями. Изолированные окружения реализованы на уровне виртуализации: для Runtime используются легковесные виртуальные машины (наподобие AWS Firecracker) либо контейнеры с полным разграничением, а для Browser – полноценные headless-браузеры внутри sandbox VM  . Инструменты (Browser, Code Interpreter) дополнительно запускают код вне основного процесса агента. Например, Python-скрипт, который агент сгенерировал и хочет исполнить, будет выполнен внутри временного контейнера с ограниченными ресурсами, сети и временем жизни, после чего результаты передаются агенту, а контейнер уничтожается  . Это гарантирует, что потенциально небезопасный код не «сбежит» и не навредит окружению агента или инфраструктуре. Браузерные сессии аналогично ограничены: агент не получает прямого доступа ни к какой чувствительной информации (cookie, учётки пользователя и т.д.), а видит только тот контент, который загрузил через Browser tool API. Если веб-страница попытается выполнить вредоносный скрипт или эксплойт, она всё равно исполняется внутри изолированного браузера на стороне AWS, а не на машине пользователя. Наконец, AgentCore Gateway при пробросе вызовов к сторонним API тоже действует как прокси с фильтрацией: он умеет применять Web Application Firewall (WAF) с настраиваемыми правилами, чтобы отсеивать явный вредонос (SQL-инъекции, XSS и пр.) в трафике агентов  .

Аудит и отслеживаемость. Важной частью zero-trust-модели является возможность отследить, что именно делал агент, какие данные использовал и какие решения принял. AgentCore обеспечивает полный аудит действий агентов. Все ключевые события фиксируются: вызовы внешних инструментов через Gateway (с отметками, каким токеном аутентифицировался агент) , действия Browser (открытие URL, клики – всё логируется в CloudTrail)  , выполнение кода (вывод и возможные ошибки в логах CloudWatch). Благодаря Observability, разработчик или безопасник может в любой момент исследовать историю сессии агента: какие шаги тот предпринял, с какими параметрами вызывал инструменты, что вернулось в ответ и т.д.  . Для удобства, AgentCore предоставляет визуальный реестр шагов (trace) – по сути, древовидный сценарий цепочки вызовов агента. Это помогает проверять корректность работы (quality audit) и соответствие агентов требованиям политики компании. Например, можно быстро выявить, не запросил ли агент какие-либо данные вне дозволенного набора или не отправил ли куда-то конфиденциальную информацию. Логи можно экспортировать и хранить для долгосрочного аудита и соответствия нормам (например, хранение истории взаимодействий для SOC 2 или HIPAA требований). В случае инцидента (подозрительной активности агента) администратор может оперативно отозвать выданные агенту учетные данные – отключить OAuth-токен пользователя через IdP или деактивировать IAM-роль – и агент сразу потеряет доступ к защищённым ресурсам. Таким образом, lifecycle доверия тоже подконтролен: разрешения можно выдавать, обновлять и отзывать динамически, обеспечивая безопасность на протяжении всего времени существования агента.

Важно подчеркнуть, что Amazon Bedrock AgentCore пока не реализует некоторых продвинутых механизмов, обсуждаемых в сообществе для AI-агентов. Например, в материалах об агентной безопасности фигурирует идея так называемого “Agent Passport” – единого цифрового удостоверения агента, криптографически подписанного и признанного во всех системах  . Такой «паспорт» мог бы содержать декларацию прав и ограничений агента, историю его действий и доверенную привязку к человеку-владельцу. В текущей версии AgentCore нет явного аналога паспорта: идентичность и права агента задаются через комбинацию вышеперечисленных средств (роль IAM, OAuth-токены, записи в IdP и пр.), а не единым сертификатом. Однако сама концепция декларативного описания способностей агента близка подходу AWS Gateway и Identity. Уже сейчас AgentCore требует явно перечислить, какие инструменты доступных агенту, какие разрешения у него есть – т.е. фактически разработчик формирует политику для агента, пусть и разнесённую по разным конфигурациям. В будущем, по мере развития открытых стандартов (таких как упомянутый Agent-to-Agent Protocol от Google), можно ожидать появления более унифицированных «удостоверений» для агентов. Например, протокол A2A вводит понятие Agent Card – структурированного профиля агента, включающего уникальный идентификатор, декларацию возможностей, поддерживаемые протоколы и параметры безопасности; такой agent card как раз и выступает в роли «паспорта» агента в сети взаимодействующих AI-сервисов  . Amazon Bedrock AgentCore уже нацелен на поддержку подобных протоколов (MCP, A2A), поэтому можно предположить, что со временем подход AWS эволюционирует в сторону ещё большей декларативности и переносимого доверия между системами.

Сравнение AgentCore и концепции Zero‑trust Agents Layer (0AL)

Концепция Zero‑trust Agents Layer (0AL) подразумевает построение инфраструктуры для агентов на принципах нулевого доверия: каждый агент рассматривается как потенциально небезопасный компонент, которому ничего не доверено «авансом», и вся его активность строго регулируется политиками и проверками. Ниже мы проведём высокоуровневое сравнение подхода AWS AgentCore с идеями 0AL по ряду ключевых аспектов.

Декларативность конфигурации. В zero-trust подходе идеалом считается задавать полномочия агента декларативно – например, с помощью некого манифеста или «паспорта», где перечислено, что ему разрешено, а что нет, и этот документ можно проверять и криптографически заверять. В современных реализациях 0AL (в исследованиях и прототипах) появляются элементы такой декларативности: например, Agent Passport может быть оформлен как Verifiable Credential с перечнем атрибутов и ограничений агента . Amazon AgentCore частично следует этому принципу, но более имплицитно. Разработчик должен явно сконфигурировать много аспектов: прописать IAM-политику роли, указать разрешённые инструменты в Gateway, подключить нужные Identity-провайдеры и задать scope токенов. Однако все эти настройки разбросаны по разным AWS-консолям/конфигам и задаются либо JSON-политиками, либо кодом. Специального единого DSL или файла декларации «что может данный агент» пока нет – это следует из совокупности настроек. В отличие от этого, гипотетический 0AL-слой мог бы предложить единую декларацию (например, YAML-манифест), которую система воспринимает как контракт с агентом. Тем не менее, по уровню детализации контроля AgentCore уже предоставляет всё необходимое: вплоть до ограничения интернет-доступа и изолированных namespace для памяти – просто эти ограничения задаются вручную администратором, а не генерируются автоматическим анализом «паспорта» агента.

Простота и гибкость настройки. Одной из целей AgentCore является упростить жизнь разработчикам, снимая с них заботы о инфраструктуре, но при этом дать гибкость выбора моделей/фреймворков. В этом отношении AWS предлагает довольно простую интеграцию – как заявлено, «несколько строк кода» чтобы подключить SDK и развернуть агента  . Возможность использовать любые LLM-модели (Bedrock, OpenAI, Anthropic, свои) и популярные фреймворки тоже добавляет гибкости  . Однако цена этой гибкости – привязка к экосистеме AWS и необходимость разбираться в её сервисах (IAM, CloudWatch, etc.). Подход 0AL скорее подразумевает агностичность к платформе и конфигурацию на более абстрактном уровне. Например, вместо настройки конкретных ролей IAM и OAuth-приложений, администратор мог бы указать: «агент имеет доступ к таким-то данным класса X и таким-то операциям класса Y» – а система сама маппит это на низкоуровневые права в конкретной среде. Пока что таких универсальных решений нет, и AWS AgentCore решает задачу за счёт тесной интеграции своих облачных сервисов. С точки зрения гибкости, AgentCore позволяет комбинировать модули по потребности – можно использовать только Runtime и Identity, без Memory или наоборот, что удобно для разных кейсов  . 0AL-концепция обычно рассматривается как сквозной слой (end-to-end), т.е. все агенты должны проходить через него для любой операции. В AWS же вы можете некоторые части не задействовать (например, не использовать Browser, если не нужно). Таким образом, AgentCore даёт практическую гибкость, а 0AL – более строгую целостность, но в потенциально обмен на сложность реализации.

Безопасность и “Agent Passport”. Zero-trust подход продвигает идею, что у каждого агента должно быть machine-verifiable удостоверение личности с ясно прописанными полномочиями – аналог пропуска на территорию с отметками, куда можно, куда нельзя. Эту роль, как уже упомянуто, может выполнять Agent Passport (иногда его называют Agent ID или Agent Card). В идеале такой паспорт подписан доверенным центром и предъявляется при каждом взаимодействии агента с новым сервисом, который по нему сразу понимает, кто агент, кому он делегирован, и что ему позволено делать  . Amazon AgentCore пока не реализует собственную систему паспорта и не требует от внешних систем признавать его агентов по какому-то единому сертификату. Вместо этого гарантия безопасности достигается за счёт интеграции с существующими механизмами: OAuth2 токенами (которые уже являются по сути краткоживущими паспортами на доступ к API), IAM-релями (которые являются проверяемыми доверительными отношениями внутри AWS), а также логированием всего и вся (чтобы любые превышения полномочий были задокументированы). Такой практический подход позволяет уже сегодня использовать агентов с минимальными изменениями в окружающих системах – они «видят» агента просто как ещё одного OAuth-клиента или AWS-роль. В то же время, 0AL предлагает более унифицированную и строгую модель: потенциально, при широком принятии, агент с паспортом мог бы проходить между разными организациями и облаками, и всюду его права были бы интерпретированы правильно и ограниченно. Например, если паспорт хранит максимальный бюджет транзакций агента и срок его действия, то любая платежная система могла бы проверить эти атрибуты перед выполнением запроса от агента  . AWS AgentCore пока не оперирует столь богатой семантикой на межсистемном уровне. Однако внутри своего стека AWS предоставляет сравнимый уровень уверенности: через CloudTrail можно отследить цепочку действий агента, через доверенную привязку IAM-ролей – установить, какой пользователь инициировал агента, и т.д. В плане аудита и жизненного цикла (lifecycle) агента, AgentCore уже реализует многие рекомендации 0AL: полноценный лог каждой сессии, возможность быстро отключить агента (отозвать его креденшелы), мониторинг аномалий. Тем не менее, если мысленно представить внедрение концепции Agent Passport в AgentCore – это мог бы быть полезный шаг, упростивший межплатформенное взаимодействие. Пока же AgentCore черпает вдохновение из zero-trust подхода больше на уровне принципов (минимальные привилегии, постоянная верификация, изоляция и наблюдение) и применяет их через проверенные облачные инструменты, вместо введения новых криптографических схем.

## Вывод

**Amazon Bedrock AgentCore можно рассматривать как практическую реализацию многих идей, заложенных в концепции 0AL, в рамках одной облачной платформы.** Он предоставляет разработчикам готовые средства для безопасной работы агентов (sandboxing, identity delegation, audit trails), требуя лишь сконфигурировать их под конкретные нужды. 0AL же – более широкая парадигма, которая может выходить за пределы одного вендора и предполагает стандартные «паспорта» и протоколы для агентов. AgentCore уже движется в этом направлении, поддерживая открытые протоколы (как MCP сейчас и A2A в перспективе) и позволяя интегрировать сторонние решения. В обозримом будущем можно ожидать взаимного влияния: идеи вроде Agent Passport и децентрализованных идентификаторов агентов   могут найти отражение в следующих версиях AgentCore, а опыт масштабного развертывания тысяч агентов на AWS послужит основой для формирования отраслевых стандартов zero-trust безопасности для AI-агентов.

## Источники

Официальная документация AWS и блог-анонс AgentCore, раздел FAQ по безопасности и Identity  , а также материалы по концепции Agent Passport и Zero-Trust Agents.

- [AgentCore Overview](https://aws.amazon.com/bedrock/agentcore/)
- [AgentCore Tools: Browser & Code Interpreter](https://aws.amazon.com/blogs/machine-learning/amazon-bedrock-agentcore-preview/)
- [AgentCore Memory, Gateway, Identity](https://docs.aws.amazon.com/bedrock/latest/userguide/agents.html)
- [Agent Passport (0AL)](https://github.com/0al-spec/agent-passport)