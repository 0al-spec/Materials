Вот структурированный список задач (task breakdown) для реализации MVP Agentification Layer по методологии Waterfall, с прицелом на твой начальный уровень в Node.js и текущий стек:

⸻

1. Подготовка среды разработки

1.1. Установи Docker Desktop на macOS
1.2. Установи VS Code с расширением Remote - Dev Containers
1.3. Создай .devcontainer с Node.js и grpc-tools
1.4. Инициализируй Node.js проект с npm init
1.5. Добавь зависимости: express, js-yaml, grpc, @grpc/proto-loader, dotenv

⸻

2. Парсер YAML-паспортов

2.1. Создай директорию passports/ и добавь тестовый YAML
2.2. Реализуй модуль passportLoader.js для чтения и валидации YAML
2.3. Определи структуру агента: id, tools, caps, routes
2.4. Проверь корректность парсинга и логирование ошибок

⸻

3. MCP-исполнитель (внутренний)

3.1. Реализуй MCP JSON-RPC сервер на express через Unix socket
3.2. Сконфигурируй endpoint /invoke с POST-приёмом JSON
3.3. Имплементируй исполнение shell-команд через child_process.spawn
3.4. Пропиши базовую проверку caps перед вызовом
3.5. Реализуй stdout/stderr стриминг в JSON-ответ
3.6. Обеспечь логирование вызовов MCP

⸻

4. A2A Discovery и Server

4.1. Импортируй .proto спецификацию A2A (submitGoal, streamResult)
4.2. Сгенерируй серверные биндинги с @grpc/proto-loader
4.3. Реализуй A2A Server на grpc.Server
4.4. При submitGoal, проксируй вызов в MCP по agent_id
4.5. При streamResult, открывай duplex-канал на stdout агента
4.6. Добавь логирование всех A2A запросов с trace_id

⸻

5. Реестр агентов и Discovery

5.1. Реализуй agentRegistry.js -- индекс паспортов по ID
5.2. На старте инициализируй список агентов из passports/
5.3. По A2A-запросу определяй наличие и путь к агенту
5.4. Поддержи hot-reload при изменении/добавлении .yaml файлов

⸻

6. Безопасность и изоляция

6.1. Реализуй контроль доступа к путям по caps из паспорта
6.2. Добавь фильтр разрешённых бинарей (whitelist tools)
6.3. Оберни spawn в минимальную sandbox (без доступа к env/uid)
6.4. Протестируй отказ на опасные команды (rm, shutdown)

⸻

7. Логирование и трассировка

7.1. Реализуй модуль logger.js для форматированного вывода
7.2. Логируй каждый A2A и MCP вызов с timestamp и agent_id
7.3. Добавь trace_id в каждую цепочку запросов
7.4. Поддержи вывод логов в stdout (journald-friendly формат)

⸻

8. Интеграция и тестирование

8.1. Напиши CLI-утилиту agentctl.js для ручных вызовов (через Unix socket)
8.2. Реализуй моковый A2A-клиент на grpc.Client
8.3. Проведи e2e тест: A2A submitGoal → MCP → stdout
8.4. Проверь поведение при ошибках в YAML, shell, пустом output
8.5. Зафиксируй кейсы в tests/e2e/ с примерами и эталонным выводом

⸻

9. Подготовка к запуску

9.1. Напиши systemd unit-файл для запуска agentifyd.js как сервиса
9.2. Обеспечь создание сокета /run/agentifyd.sock с правами
9.3. Протестируй ручной запуск демона и его перезапуск
9.4. Подготовь docker-compose с volume для passports/
9.5. Напиши README.md с инструкцией установки и примерами запросов

⸻

10. Документация и завершение

10.1. Задокументируй структуру паспорта (YAML schema)
10.2. Оформи Swagger/OpenAPI для MCP /invoke
10.3. Оформи .proto спецификацию и описание gRPC-сервисов
10.4. Составь страницу architecture.md с описанием взаимодействия компонентов
10.5. Проведи ручной walkthrough и составь список TODO для следующей итерации