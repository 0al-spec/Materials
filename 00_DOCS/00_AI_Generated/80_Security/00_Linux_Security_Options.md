# Linux Security

üîê seccomp (Secure Computing Mode)

–ß—Ç–æ —ç—Ç–æ:
–ú–µ—Ö–∞–Ω–∏–∑–º —è–¥—Ä–∞ Linux, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–µ –≤—ã–∑–æ–≤—ã (syscalls), –¥–æ—Å—Ç—É–ø–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—É.

–ü—Ä–∏–º–µ—Ä:
–ú–æ–∂–Ω–æ —Ä–∞–∑—Ä–µ—à–∏—Ç—å —Ç–æ–ª—å–∫–æ 10 —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤ ‚Äî –≤—Å—ë –æ—Å—Ç–∞–ª—å–Ω–æ–µ –±—É–¥–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å—Å—è (–æ–±—ã—á–Ω–æ —Å –æ—à–∏–±–∫–æ–π –∏–ª–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ–º –ø—Ä–æ—Ü–µ—Å—Å–∞).

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è:
	‚Ä¢	–ü–µ—Å–æ—á–Ω–∏—Ü (sandboxing)
	‚Ä¢	–ó–∞—â–∏—Ç—ã –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ Docker, LXC)
	‚Ä¢	–ú–∏–Ω–∏–º–∏–∑–∞—Ü–∏–∏ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏ –∞—Ç–∞–∫–∏

–ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞:

prctl(PR_SET_SECCOMP, SECCOMP_MODE_STRICT);


‚∏ª

üóÇ chroot (Change Root Directory)

–ß—Ç–æ —ç—Ç–æ:
–°–∏—Å—Ç–µ–º–Ω—ã–π –≤—ã–∑–æ–≤, –º–µ–Ω—è—é—â–∏–π –≤–∏–¥–∏–º—É—é –∫–æ—Ä–Ω–µ–≤—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é (/) –¥–ª—è –ø—Ä–æ—Ü–µ—Å—Å–∞ –∏ –µ–≥–æ –ø–æ—Ç–æ–º–∫–æ–≤.

–≠—Ñ—Ñ–µ–∫—Ç:
–ü—Ä–æ—Ü–µ—Å—Å –±–æ–ª—å—à–µ –Ω–µ –≤–∏–¥–∏—Ç –Ω–∏—á–µ–≥–æ –≤–Ω–µ —Å–≤–æ–µ–π ‚Äú–ø–µ—Å–æ—á–Ω–∏—Ü—ã‚Äù (–Ω–∞–ø—Ä–∏–º–µ—Ä, /home/myapp —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω–æ–≤—ã–º /).

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è:
	‚Ä¢	–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ
	‚Ä¢	–°—Ç–∞—Ä—ã—Ö —Ñ–æ—Ä–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏–∏ –∏ —Å–±–æ—Ä–æ–∫

–í–∞–∂–Ω–æ: chroot –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –ø–æ–ª–Ω–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –∏–∑–æ–ª—è—Ü–∏–µ–π ‚Äî –µ–≥–æ –º–æ–∂–Ω–æ –æ–±–æ–π—Ç–∏ –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ root-–¥–æ—Å—Ç—É–ø–∞ –≤–Ω—É—Ç—Ä–∏.

‚∏ª

üõ° capabilities (POSIX Capabilities / cap-lists)

–ß—Ç–æ —ç—Ç–æ:
–ú–µ—Ö–∞–Ω–∏–∑–º —è–¥—Ä–∞ Linux –¥–ª—è –¥—Ä–æ–±–ª–µ–Ω–∏—è –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π root –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—ã–µ ¬´—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏¬ª (CAP_NET_ADMIN, CAP_SYS_PTRACE, –∏ —Ç.–ø.).

–ü—Ä–∏–º–µ—Ä:
–ü—Ä–æ—Ü–µ—Å—Å –º–æ–∂–µ—Ç –±—ã—Ç—å –±–µ–∑ –ø–æ–ª–Ω–æ–≥–æ root-–¥–æ—Å—Ç—É–ø–∞, –Ω–æ –∏–º–µ—Ç—å —Ç–æ–ª—å–∫–æ CAP_NET_BIND_SERVICE, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã–≤–∞—Ç—å –ø–æ—Ä—Ç—ã –Ω–∏–∂–µ 1024.

–ß–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ capability-—Ñ–ª–∞–≥–∏:
	‚Ä¢	CAP_NET_ADMIN ‚Äî –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ç–µ–≤—ã—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤
	‚Ä¢	CAP_SYS_ADMIN ‚Äî —Å—É–ø–µ—Ä–ø—Ä–∏–≤–∏–ª–µ–≥–∏—è (–ø–æ—á—Ç–∏ root)
	‚Ä¢	CAP_CHOWN ‚Äî –∏–∑–º–µ–Ω–µ–Ω–∏–µ –≤–ª–∞–¥–µ–ª—å—Ü–∞ —Ñ–∞–π–ª–æ–≤

–°–ø–∏—Å–∫–∏ cap-–ª–∏—Å—Ç–æ–≤:
	‚Ä¢	Effective ‚Äî —Ä–µ–∞–ª—å–Ω–æ –∞–∫—Ç–∏–≤–Ω—ã–µ
	‚Ä¢	Permitted ‚Äî –º–æ–∂–Ω–æ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å
	‚Ä¢	Inheritable ‚Äî –Ω–∞—Å–ª–µ–¥—É–µ–º—ã–µ
	‚Ä¢	Bounding ‚Äî –≥–ª–æ–±–∞–ª—å–Ω—ã–π –ª–∏–º–∏—Ç

‚∏ª

–í —Å–≤—è–∑–∫–µ:

–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã, –ø–µ—Å–æ—á–Ω–∏—Ü—ã –∏ —Å–∏—Å—Ç–µ–º—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –≤—Å—ë –≤–º–µ—Å—Ç–µ:
	‚Ä¢	seccomp ‚Äî –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–µ –≤—ã–∑–æ–≤—ã
	‚Ä¢	chroot ‚Äî –∑–∞–º–∫–Ω—É—Ç—å —Ñ–∞–π–ª–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É
	‚Ä¢	capabilities ‚Äî –æ—Ç–æ–±—Ä–∞—Ç—å root-–ø—Ä–∏–≤–∏–ª–µ–≥–∏–∏

‚∏ª

–•–æ—á–µ—à—å, —è –ø–æ–∫–∞–∂—É –∫–∞–∫ –∑–∞–¥–∞—Ç—å –≤—Å—ë —ç—Ç–æ –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ ‚Äî –Ω–∞–ø—Ä–∏–º–µ—Ä, —á–µ—Ä–µ–∑ systemd, docker, –∏–ª–∏ –≤—Ä—É—á–Ω—É—é –∏–∑ C –∏–ª–∏ Rust?

## –í–æ—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ –¥–ª—è –ø–æ–ª–Ω–æ—Ç—ã –∫–∞—Ä—Ç–∏–Ω—ã:

‚∏ª

üì¶ 1. Namespaces

–ß—Ç–æ —ç—Ç–æ:
–ú–µ—Ö–∞–Ω–∏–∑–º –∏–∑–æ–ª—è—Ü–∏–∏ —Ä–µ—Å—É—Ä—Å–æ–≤ —è–¥—Ä–∞ –º–µ–∂–¥—É –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏. –ö–∞–∂–¥—ã–π —Ç–∏–ø namespace –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —Å–≤–æ—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é —Ä–µ—Å—É—Ä—Å–æ–≤.

–í–∏–¥—ã:
	‚Ä¢	pid ‚Äî –ø—Ä–æ—Ü–µ—Å—Å—ã
	‚Ä¢	mnt ‚Äî —Ñ–∞–π–ª–æ–≤—ã–µ —Å–∏—Å—Ç–µ–º—ã (–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
	‚Ä¢	net ‚Äî —Å–µ—Ç–µ–≤—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã
	‚Ä¢	uts ‚Äî hostname –∏ domain name
	‚Ä¢	ipc ‚Äî –æ—á–µ—Ä–µ–¥–∏ —Å–æ–æ–±—â–µ–Ω–∏–π, —Å–µ–º–∞—Ñ–æ—Ä—ã –∏ –ø—Ä.
	‚Ä¢	user ‚Äî UID/GID –≤–Ω—É—Ç—Ä–∏ namespace
	‚Ä¢	cgroup ‚Äî –∫–æ–Ω—Ç—Ä–æ–ª—å —Ä–µ—Å—É—Ä—Å–æ–≤ (—Å–º. –Ω–∏–∂–µ)

–ü—Ä–∏–º–µ—Ä:
–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏–º–µ–µ—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π PID namespace ‚Äî –µ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å—ã –Ω–µ –≤–∏–¥–Ω—ã —Å–Ω–∞—Ä—É–∂–∏.

‚∏ª

üìâ 2. cgroups (Control Groups)

–ß—Ç–æ —ç—Ç–æ:
–ú–µ—Ö–∞–Ω–∏–∑–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–∞–º–∏ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤: CPU, –ø–∞–º—è—Ç—å, IO, —Å–µ—Ç–∏ –∏ —Ç.–ø.

–ü–æ–∑–≤–æ–ª—è–µ—Ç:
	‚Ä¢	–û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ CPU —è–¥—Ä–∞
	‚Ä¢	–ó–∞–¥–∞—Ç—å –ª–∏–º–∏—Ç –ø–æ –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–º—è—Ç–∏
	‚Ä¢	–í—ã—Å—Ç–∞–≤–∏—Ç—å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç IO-–æ–ø–µ—Ä–∞—Ü–∏–π

–ü—Ä–∏–º–µ—Ä:
cgroup –º–æ–∂–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å –¥–æ 512MB RAM.

‚∏ª

üîí 3. AppArmor / SELinux

–ß—Ç–æ —ç—Ç–æ:
–ú–∞–Ω–¥–∞—Ç–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã –∫–æ–Ω—Ç—Ä–æ–ª—è –¥–æ—Å—Ç—É–ø–∞ (MAC), –æ–ø—Ä–µ–¥–µ–ª—è—é—â–∏–µ, —á—Ç–æ –º–æ–∂–µ—Ç –¥–µ–ª–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å –Ω–∞ —É—Ä–æ–≤–Ω–µ —è–¥—Ä–∞, –¥–∞–∂–µ –µ—Å–ª–∏ —É –Ω–µ–≥–æ –µ—Å—Ç—å –ø—Ä–∞–≤–∞.
	‚Ä¢	AppArmor ‚Äî –ø—Ä–æ—Ñ–∏–ª–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—É—Ç–µ–π —Ñ–∞–π–ª–æ–≤
	‚Ä¢	SELinux ‚Äî —Ç–µ–≥–∏ –∏ –ø—Ä–∞–≤–∏–ª–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –Ω–∞ –æ–±—ä–µ–∫—Ç—ã

–ü—Ä–∏–º–µ—Ä:
–ü—Ä–æ—Ü–µ—Å—Å—É —Ä–∞–∑—Ä–µ—à–µ–Ω–æ —á–∏—Ç–∞—Ç—å —Ç–æ–ª—å–∫–æ /etc/myapp/config, –Ω–æ –Ω–µ /etc/passwd, –¥–∞–∂–µ –µ—Å–ª–∏ —É –Ω–µ–≥–æ –µ—Å—Ç—å –ø—Ä–∞–≤–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ –û–°.

‚∏ª

üöß 4. no_new_privs

–ß—Ç–æ —ç—Ç–æ:
–§–ª–∞–≥, –∑–∞–ø—Ä–µ—â–∞—é—â–∏–π –ø—Ä–æ—Ü–µ—Å—Å—É –ø—Ä–∏–æ–±—Ä–µ—Ç–∞—Ç—å –Ω–æ–≤—ã–µ –ø—Ä–∏–≤–∏–ª–µ–≥–∏–∏, –¥–∞–∂–µ –µ—Å–ª–∏ –æ–Ω –∑–∞–ø—É—Å–∫–∞–µ—Ç setuid-–±–∏–Ω–∞—Ä–Ω–∏–∫–∏ –∏–ª–∏ –∏–º–µ–µ—Ç —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –≤ file capabilities.

–ü—Ä–∏–º–µ—Ä:
–ï—Å–ª–∏ –≤–∫–ª—é—á—ë–Ω no_new_privs, –≤—ã–∑–æ–≤ exec() –Ω–µ –ø–æ–¥–Ω–∏–º–µ—Ç –ø—Ä–∏–≤–∏–ª–µ–≥–∏–∏.

‚∏ª

üß© 5. Landlock (–Ω–æ–≤–æ–µ)

–ß—Ç–æ —ç—Ç–æ:
–û—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –Ω–æ–≤—ã–π –º–µ—Ö–∞–Ω–∏–∑–º (—Å Linux 5.13+), –ø–æ–∑–≤–æ–ª—è—é—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º (–Ω–µ root‚Äô—É!) –∑–∞–¥–∞—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ.

–ü–æ–∑–≤–æ–ª—è–µ—Ç:
–°–æ–∑–¥–∞–≤–∞—Ç—å sandbox –∏–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ ‚Äî –ø–æ–ª–µ–∑–Ω–æ –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π —Å –ø–ª–∞–≥–∏–Ω–∞–º–∏ –∏–ª–∏ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π —á—É–∂–∏—Ö –¥–∞–Ω–Ω—ã—Ö.

‚∏ª

üßç 6. User namespaces

–ß—Ç–æ —ç—Ç–æ:
–ß–∞—Å—Ç—å –æ–±—â–∏—Ö namespaces, –Ω–æ –æ—Å–æ–±–æ –≤–∞–∂–Ω–∞—è: –ø–æ–∑–≤–æ–ª—è–µ—Ç –º–∞–ø–ø–∏—Ç—å UID –∏ GID –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∫ –Ω–µ-root –∑–∞ –µ–≥–æ –ø—Ä–µ–¥–µ–ª–∞–º–∏.

–≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç:
	‚Ä¢	–í–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –ø—Ä–æ—Ü–µ—Å—Å ‚Äî root (UID 0)
	‚Ä¢	–°–Ω–∞—Ä—É–∂–∏ –æ–Ω ‚Äî –æ–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, UID 1000)
	‚Ä¢	–î–∞–∂–µ –ø—Ä–∏ chroot –∏ capabilities ‚Äî –æ—Å—Ç–∞—ë—Ç—Å—è –±–µ–∑–æ–ø–∞—Å–Ω—ã–º

‚∏ª

üì¶ –û–±—ä–µ–¥–∏–Ω—ë–Ω–Ω—ã–π —Å—Ç–µ–∫ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ / –∞–≥–µ–Ω—Ç–∞:

–ö–∞—Ç–µ–≥–æ—Ä–∏—è	–ú–µ—Ö–∞–Ω–∏–∑–º	–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
–°–∏—Å—Ç–µ–º–Ω—ã–µ –≤—ã–∑–æ–≤—ã	seccomp	–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤
–§–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞	chroot, mnt ns, Landlock	–ò–∑–æ–ª—è—Ü–∏—è –∏ –∫–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞ –∫ –§–°
–ü—Ä–∏–≤–∏–ª–µ–≥–∏–∏	capabilities, no_new_privs, user ns	–ú–∏–Ω–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–∞–≤
–ò–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç—å	user namespaces	–ò–∑–æ–ª—è—Ü–∏—è UID/GID
–†–µ—Å—É—Ä—Å—ã	cgroups	–ö–æ–Ω—Ç—Ä–æ–ª—å CPU, –ø–∞–º—è—Ç–∏, IO –∏ –¥—Ä.
–î–æ—Å—Ç—É–ø –∫ –æ–±—ä–µ–∫—Ç–∞–º	AppArmor, SELinux	–ñ—ë—Å—Ç–∫–∏–µ –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–æ—Å—Ç—É–ø–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ —è–¥—Ä–∞
–§—Ä–µ–π–º–≤–æ—Ä–∫–∏	systemd, Docker, podman, lxc	–£–ø—Ä–æ—â—ë–Ω–Ω–∞—è –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è –≤—Å–µ—Ö –≤—ã—à–µ–ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–Ω—ã—Ö


‚∏ª

–•–æ—á–µ—à—å, —è —Å–æ—Å—Ç–∞–≤–ª—é –∫–æ—Ä–æ—Ç–∫–∏–π —á–µ–∫–ª–∏—Å—Ç –∏–ª–∏ —Å–Ω–∏–ø–ø–µ—Ç –ø–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞–Ω–∏—é sandboxed-–ø—Ä–æ—Ü–µ—Å—Å–∞ –¥–ª—è —Ç–≤–æ–µ–≥–æ –∞–≥–µ–Ω—Ç–∞ –Ω–∞ Rust –∏–ª–∏ —á–µ—Ä–µ–∑ systemd?